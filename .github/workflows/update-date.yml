name: Update Date in README

on:
  push:
    paths:
      - 'README.md'

jobs:
  update_date:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Wiki repository
      uses: actions/checkout@v3
      with:
        fetch-depth: 2

    - name: Atualizar data no README.md, se modificado
      run: |
        git fetch origin main
        MODIFIED_FILES=$(git diff --name-only HEAD~1 HEAD 2>/dev/null | grep '\.md$' || true)

        if [ -z "$MODIFIED_FILES" ]; then
          echo "README.md nÃ£o foi modificado. Encerrando workflow."
          exit 0
        fi
        
        for FILE_PATH in $MODIFIED_FILES; do
          echo "Atualizando data em: $MODIFIED_FILES""
          LAST_MODIFIED=$(date +"%Y-%m-%d %H:%M:%S")
          
          if grep -q "^Ãšltima modificaÃ§Ã£o em:" "README.md"; then
            sed -i "s/^Ãšltima modificaÃ§Ã£o em:.*/Ãšltima modificaÃ§Ã£o em: $LAST_MODIFIED/" "README.md"
          else
            echo -e "\n**Ãšltima modificaÃ§Ã£o em:** $LAST_MODIFIED" >> "README.md"
          fi
        done

        git config --global user.name "prfs91"
        git config --global user.email "71240638+prfs91@users.noreply.github.com"

        git add README.md
        git commit -m "ðŸ“š docs(workflow): Update modification date in README.md" || echo "Nenhuma alteraÃ§Ã£o para commitar"
        git push
        
        git push https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/prfs91/VolunteerCodeCarajas.wiki.git
