name: Atualizar data de modificaÃ§Ã£o em arquivos Markdown

on:
  push:
    paths:
      - "docs/**/*.md"

jobs:
  update_date:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Wiki repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 2

      - name: Atualizar data nos arquivos modificados
        run: |
          export TZ=America/Sao_Paulo
          git fetch origin main
          MODIFIED_FILES=$(git diff --name-only HEAD~1 HEAD 2>/dev/null | grep '^docs/.*\.md$' || true)

          if [ -z "$MODIFIED_FILES" ]; then
            echo "Nenhum arquivo .md em /docs ou o README.md foi modificado. Encerrando workflow."
            exit 0
          fi

          for FILE_PATH in $MODIFIED_FILES; do
            echo "Atualizando data em: $FILE_PATH"
            LAST_MODIFIED=$(date +"%Y-%m-%d %H:%M:%S (America/Sao_Paulo)")

            if grep -q "^\*\*Ãšltima modificaÃ§Ã£o em:\*\*" "$FILE_PATH"; then
              sed -i "s|^\*\*Ãšltima modificaÃ§Ã£o em:\*\*.*|**Ãšltima modificaÃ§Ã£o em:** $LAST_MODIFIED|" "$FILE_PATH"
            else
              echo -e "\n**Ãšltima modificaÃ§Ã£o em:** $LAST_MODIFIED" >> "$FILE_PATH"
            fi
          done

          git config --global user.name "prfs91"
          git config --global user.email "71240638+prfs91@users.noreply.github.com"

          git add $MODIFIED_FILES
          git commit -m "ðŸ“š docs(workflow): Update last modified date in markdown files" || echo "Nothing to commit"
          git push
